{% extends "base.html" %}

{% load static %}

{% block sidenav %}
    {% for item in item_list %}
        {% if item.item == "Favorites" or item.item == "My Books" or item.item == "My Shopping Cart" %}
            {% if user.is_authenticated %}
                <li><a href="{{ item.link }}">{{ item.item }}</a></li>
            {% endif %}
        {% else %}
            <li><a href="{{ item.link }}">{{ item.item }}</a></li>
        {% endif %}
    {% endfor %}
{% endblock sidenav %}

{% block content %}
    <h1>Display Books</h1>
    <table border="2">
        <tr>
            <th>Book Name</th>
            <th>Book Price</th>
            <th>Book Web</th>
            <th>Genre</th>
            {% if user.is_authenticated %}
                <th>Favorites</th>
            {% endif %}


        </tr>
        {% for book in books %}
            <tr>
                <td>
                    <a href="book_detail/{{ book.id }}"> {{ book.name }} </a>
                </td>
                <td>
                    {{ book.price }}
                </td>
                <td>
                    <img src="{% static book.pic_path %}" width="100" />
                </td>
                <td>{{ book.genre }}</td>
                {% if user.is_authenticated %}
                <td>
                    <form method="post" action="{% url 'toggle_favorite' book.id %}">
                        {% csrf_token %}
                        <button type="submit" style="background-color: white; border: 1px solid #ccc;">
                            {% if user in book.favorites.all %}
                                <span style="color: red;">★</span> Unfavorite
                            {% else %}
                                <span style="color: gold;">★</span> Favorite
                            {% endif %}
                        </button>
                    </form>
                </td>
                <td>
                    <a href="{% url 'add_to_cart' book.id %}" class="cart-button">Add to Cart</a>
                </td>
                {% endif %}
            </tr>
        {% endfor %}
    </table>
{% endblock content %}
